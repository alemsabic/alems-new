{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/components/author/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import { RendererLike, rxLiteral as rxl } from '@connectv/html';\nimport { transport } from '@connectv/sdh/transport';\nimport { ThemedComponentThis } from '@connectv/jss-theme';\nimport { CodedocTheme } from '@codedoc/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { ajax } from 'rxjs/ajax';\n\nimport { AuthorStyle } from './style';\n\n\nexport interface AuthorOptionsDirect {\n  name: string;\n  date: string;\n  avatar?: string;\n  url?: string;\n}\n\n\nexport interface AuthorOptionsFetch {\n  src: 'github';\n  date?: string;\n}\n\n\nfunction isDirect(options: AuthorOptionsDirect | AuthorOptionsFetch) : options is AuthorOptionsDirect {\n  return !(options as any).src;\n}\n\n\ninterface CommitType {\n  commit: {\n    author: {\n      date: string;\n      name: string;\n    }\n  },\n  author?: {\n    avatar_url: string;\n    html_url: string;\n  }\n}\n\n\nconst _DefaultAvatar = 'https://www.wallpaperup.com/uploads/wallpapers/2017/09/17/1099153/afb7cf163e10008fb6ca7ca80e8c9a6d-700.jpg';\n\n\nexport function Author(\n  this: ThemedComponentThis<CodedocTheme>,\n  options: AuthorOptionsDirect | AuthorOptionsFetch,\n  renderer: RendererLike<any, any>\n) {\n  const classes = this.theme.classes(AuthorStyle);\n  const avatar = new BehaviorSubject<string>(_DefaultAvatar);\n  const name = new BehaviorSubject<string>('Anonymous Author');\n  const date = new BehaviorSubject<string>('Unspecified Date');\n  const url = new BehaviorSubject<string>('');\n\n  this.track({\n    bind() {\n      if (isDirect(options)) {\n        name.next(options.name);\n        date.next(options.date);\n        if (options.avatar) avatar.next(options.avatar);\n        if (options.url) url.next(options.url);\n      } else {\n        if (options.src === 'github') {\n          const src = (window as any).source;\n          const github = (window as any).githubConfig;\n          if (src && github) {\n            ajax.getJSON<CommitType[]>(`https://api.github.com/repos/${github.user}/${github.repo}/commits`\n                      + `?path=${src.base}/${src.path}`)\n              .subscribe(res => {\n                if (res.length) {\n                  const commit = res[0];\n                  avatar.next(commit.author?.avatar_url || _DefaultAvatar);\n                  url.next(commit.author?.html_url || '');\n                  name.next(commit.commit.author.name);\n                  const dateString = !!options.date ? options.date : commit.commit.author.date;\n                  date.next(new Date(dateString).toDateString());\n                }\n              });\n          }\n        }\n      }\n    }\n  })\n\n  return <a class={classes.author} href={url} target=\"_blank\">\n    <div class={classes.avatar} style={rxl`background-image: url(${avatar})`}/>\n    <div class={classes.texts}>\n      <div class={classes.name}>{name}</div>\n      <div class={classes.date}><label>Last Publish:</label> {date}</div>\n    </div>\n  </a>\n}\n\n\nexport const Author$ = /*#__PURE__*/transport(Author);"]}